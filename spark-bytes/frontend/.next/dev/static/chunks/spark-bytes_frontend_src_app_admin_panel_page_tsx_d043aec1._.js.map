{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/reneetsui/Desktop/391%20project/cs391-project/spark-bytes/frontend/src/app/admin_panel/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { supabase } from \"@/lib/supabaseClient\";\n\nexport default function AdminPanel() {\n  const router = useRouter();\n  const [authorized, setAuthorized] = useState(false);\n  const [requests, setRequests] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  \n  // SECURITY CHECK: ADMIN ONLY\n  \n  useEffect(() => {\n    async function checkRole() {\n      const { data: { user } } = await supabase.auth.getUser();\n\n      if (!user) {\n        router.push(\"/login\");\n        return;\n      }\n\n      const { data: profile } = await supabase\n        .from(\"profiles\")\n        .select(\"role\")\n        .eq(\"id\", user.id)\n        .single();\n\n      if (profile?.role !== \"admin\") {\n        router.push(\"/request_access\");\n        return;\n      }\n\n      setAuthorized(true);\n    }\n\n    checkRole();\n  }, []);\n\n  // ---------------------------\n  // FETCH PENDING REQUESTS\n  // ---------------------------\n  useEffect(() => {\n    if (!authorized) return;\n\n    async function loadRequests() {\n      const { data, error } = await supabase\n        .from(\"admin_requests\")\n        .select(\"*\")\n        .order(\"created_at\", { ascending: false });\n\n      if (!error) setRequests(data || []);\n      setLoading(false);\n    }\n\n    loadRequests();\n  }, [authorized]);\n\n  // ---------------------------\n  // APPROVE USER\n  // ---------------------------\n  async function approveRequest(request: any) {\n    // 1) promote user to admin\n    await supabase\n      .from(\"profiles\")\n      .update({ role: \"admin\" })\n      .eq(\"id\", request.user_id);\n\n    // 2) remove the request\n    await supabase\n      .from(\"admin_requests\")\n      .delete()\n      .eq(\"id\", request.id);\n\n    // 3) update UI\n    setRequests((prev) => prev.filter((r) => r.id !== request.id));\n  }\n\n  if (!authorized) return null;\n\n  return (\n    <div className=\"min-h-screen flex flex-col bg-gradient-to-b from-white via-teal-50 to-teal-100 px-6 py-16\">\n      <h1 className=\"text-3xl font-semibold text-center mb-10\">Admin Requests</h1>\n\n      {loading ? (\n        <p className=\"text-center text-gray-600\">Loading...</p>\n      ) : requests.length === 0 ? (\n        <p className=\"text-center text-gray-600\">\n          No pending admin access requests.\n        </p>\n      ) : (\n        <div className=\"max-w-3xl mx-auto space-y-4\">\n          {requests.map((req) => (\n            <div\n              key={req.id}\n              className=\"bg-white border border-gray-300 p-6 rounded-xl shadow-sm flex items-center justify-between\"\n            >\n              <div>\n                <p className=\"font-semibold\">{req.email}</p>\n                <p className=\"text-gray-600 text-sm\">\n                  Requested at: {new Date(req.created_at).toLocaleString()}\n                </p>\n              </div>\n\n              <button\n                onClick={() => approveRequest(req)}\n                className=\"bg-teal-600 text-white px-5 py-2 rounded-lg hover:bg-teal-700 transition\"\n              >\n                Approve\n              </button>\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":["c","_c","useEffect","useState","useRouter","supabase","AdminPanel","$","$i","Symbol","for","router","authorized","setAuthorized","t0","requests","setRequests","loading","setLoading","t1","AdminPanel[useEffect()]","checkRole","data","t2","auth","getUser","user","push","profile","from","select","eq","id","single","role","t3","t4","loadRequests","error","order","ascending","t5","approveRequest","request","update","user_id","delete","prev","filter","r","t6","t7","length","map","req","email","Date","created_at","toLocaleString","AdminPanel[requests.map() > <button>.onClick]"],"mappings":"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","ignoreList":[],"debugId":null}}]
}