{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/reneetsui/Desktop/391%20project/cs391-project/spark-bytes/frontend/src/app/admin_panel/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { supabase } from \"@/lib/supabaseClient\";\n\nexport default function AdminPanel() {\n  const router = useRouter();\n  const [authorized, setAuthorized] = useState(false);\n  const [requests, setRequests] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  \n  // SECURITY CHECK: ADMIN ONLY\n  \n  useEffect(() => {\n    async function checkRole() {\n      const { data: { user } } = await supabase.auth.getUser();\n\n      if (!user) {\n        router.push(\"/login\");\n        return;\n      }\n\n      const { data: profile } = await supabase\n        .from(\"profiles\")\n        .select(\"role\")\n        .eq(\"id\", user.id)\n        .single();\n\n      if (profile?.role !== \"admin\") {\n        router.push(\"/request_access\");\n        return;\n      }\n\n      setAuthorized(true);\n    }\n\n    checkRole();\n  }, []);\n\n  // ---------------------------\n  // FETCH PENDING REQUESTS\n  // ---------------------------\n  useEffect(() => {\n    if (!authorized) return;\n\n    async function loadRequests() {\n      const { data, error } = await supabase\n        .from(\"admin_requests\")\n        .select(\"*\")\n        .order(\"created_at\", { ascending: false });\n\n      if (!error) setRequests(data || []);\n      setLoading(false);\n    }\n\n    loadRequests();\n  }, [authorized]);\n\n  // ---------------------------\n  // APPROVE USER\n  // ---------------------------\n  async function approveRequest(request: any) {\n    // 1) promote user to admin\n    await supabase\n      .from(\"profiles\")\n      .update({ role: \"admin\" })\n      .eq(\"id\", request.user_id);\n\n    // 2) remove the request\n    await supabase\n      .from(\"admin_requests\")\n      .delete()\n      .eq(\"id\", request.id);\n\n    // 3) update UI\n    setRequests((prev) => prev.filter((r) => r.id !== request.id));\n  }\n\n  if (!authorized) return null;\n\n  return (\n    <div className=\"min-h-screen flex flex-col bg-gradient-to-b from-white via-teal-50 to-teal-100 px-6 py-16\">\n      <h1 className=\"text-3xl font-semibold text-center mb-10\">Admin Requests</h1>\n\n      {loading ? (\n        <p className=\"text-center text-gray-600\">Loading...</p>\n      ) : requests.length === 0 ? (\n        <p className=\"text-center text-gray-600\">\n          No pending admin access requests.\n        </p>\n      ) : (\n        <div className=\"max-w-3xl mx-auto space-y-4\">\n          {requests.map((req) => (\n            <div\n              key={req.id}\n              className=\"bg-white border border-gray-300 p-6 rounded-xl shadow-sm flex items-center justify-between\"\n            >\n              <div>\n                <p className=\"font-semibold\">{req.email}</p>\n                <p className=\"text-gray-600 text-sm\">\n                  Requested at: {new Date(req.created_at).toLocaleString()}\n                </p>\n              </div>\n\n              <button\n                onClick={() => approveRequest(req)}\n                className=\"bg-teal-600 text-white px-5 py-2 rounded-lg hover:bg-teal-700 transition\"\n              >\n                Approve\n              </button>\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAJA;;;;;AAMe,SAAS;IACtB,MAAM,SAAS,IAAA,6KAAS;IACxB,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,+OAAQ,EAAC;IAC7C,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,+OAAQ,EAAQ,EAAE;IAClD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,+OAAQ,EAAC;IAGvC,6BAA6B;IAE7B,IAAA,gPAAS,EAAC;QACR,eAAe;YACb,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,GAAG,MAAM,sKAAQ,CAAC,IAAI,CAAC,OAAO;YAEtD,IAAI,CAAC,MAAM;gBACT,OAAO,IAAI,CAAC;gBACZ;YACF;YAEA,MAAM,EAAE,MAAM,OAAO,EAAE,GAAG,MAAM,sKAAQ,CACrC,IAAI,CAAC,YACL,MAAM,CAAC,QACP,EAAE,CAAC,MAAM,KAAK,EAAE,EAChB,MAAM;YAET,IAAI,SAAS,SAAS,SAAS;gBAC7B,OAAO,IAAI,CAAC;gBACZ;YACF;YAEA,cAAc;QAChB;QAEA;IACF,GAAG,EAAE;IAEL,8BAA8B;IAC9B,yBAAyB;IACzB,8BAA8B;IAC9B,IAAA,gPAAS,EAAC;QACR,IAAI,CAAC,YAAY;QAEjB,eAAe;YACb,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,sKAAQ,CACnC,IAAI,CAAC,kBACL,MAAM,CAAC,KACP,KAAK,CAAC,cAAc;gBAAE,WAAW;YAAM;YAE1C,IAAI,CAAC,OAAO,YAAY,QAAQ,EAAE;YAClC,WAAW;QACb;QAEA;IACF,GAAG;QAAC;KAAW;IAEf,8BAA8B;IAC9B,eAAe;IACf,8BAA8B;IAC9B,eAAe,eAAe,OAAY;QACxC,2BAA2B;QAC3B,MAAM,sKAAQ,CACX,IAAI,CAAC,YACL,MAAM,CAAC;YAAE,MAAM;QAAQ,GACvB,EAAE,CAAC,MAAM,QAAQ,OAAO;QAE3B,wBAAwB;QACxB,MAAM,sKAAQ,CACX,IAAI,CAAC,kBACL,MAAM,GACN,EAAE,CAAC,MAAM,QAAQ,EAAE;QAEtB,eAAe;QACf,YAAY,CAAC,OAAS,KAAK,MAAM,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,QAAQ,EAAE;IAC9D;IAEA,IAAI,CAAC,YAAY,OAAO;IAExB,qBACE,4QAAC;QAAI,WAAU;;0BACb,4QAAC;gBAAG,WAAU;0BAA2C;;;;;;YAExD,wBACC,4QAAC;gBAAE,WAAU;0BAA4B;;;;;uBACvC,SAAS,MAAM,KAAK,kBACtB,4QAAC;gBAAE,WAAU;0BAA4B;;;;;qCAIzC,4QAAC;gBAAI,WAAU;0BACZ,SAAS,GAAG,CAAC,CAAC,oBACb,4QAAC;wBAEC,WAAU;;0CAEV,4QAAC;;kDACC,4QAAC;wCAAE,WAAU;kDAAiB,IAAI,KAAK;;;;;;kDACvC,4QAAC;wCAAE,WAAU;;4CAAwB;4CACpB,IAAI,KAAK,IAAI,UAAU,EAAE,cAAc;;;;;;;;;;;;;0CAI1D,4QAAC;gCACC,SAAS,IAAM,eAAe;gCAC9B,WAAU;0CACX;;;;;;;uBAbI,IAAI,EAAE;;;;;;;;;;;;;;;;AAsBzB","debugId":null}}]
}