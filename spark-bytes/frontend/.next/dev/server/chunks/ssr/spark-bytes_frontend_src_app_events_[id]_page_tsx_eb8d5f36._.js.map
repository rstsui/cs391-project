{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/karachionwuanibe/Desktop/cs~391/projects/cs391-project2/cs391-project/spark-bytes/frontend/src/app/events/%5Bid%5D/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useParams } from \"next/navigation\";\nimport { supabase } from \"@/lib/supabaseClient\";\nimport { useEffect, useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\n\n// Event + Food Types\ntype FoodItem = {\n  name: string;\n  quantity: number;\n};\n\ntype EventType = {\n  id: number;\n  title: string;\n  description: string;\n  location: string;\n  event_date: string;\n  event_time: string;\n  food_items: FoodItem[];\n  capacity: number;\n  attendees: number;\n  organizer_email: string;\n};\n\nexport default function EventInfoPage() {\n  const params = useParams();\n  const eventId = params.id as string;\n  const router = useRouter();\n\n  const [event, setEvent] = useState<EventType | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [selectedFood, setSelectedFood] = useState(\"\");\n  const [quantity, setQuantity] = useState(1);\n\n  const [name, setName] = useState(\"\");\n  const [email, setEmail] = useState(\"\");\n\n  // Fetch event + RSVPs\n  useEffect(() => {\n    async function loadEvent() {\n      const { data, error } = await supabase\n        .from(\"events\")\n        .select(\"*\")\n        .eq(\"id\", eventId)\n        .maybeSingle();\n\n      if (error) {\n        console.error(error);\n        return;\n      }\n\n      setEvent(data as EventType);\n      setLoading(false);\n    }\n\n    loadEvent();\n  }, [eventId]);\n\n  // Submit RSVP\n  async function handleReserve(e: React.FormEvent<HTMLFormElement>) {\n    e.preventDefault();\n    if (!event) return;\n\n    // 1. Capacity check\n    if (event.attendees >= event.capacity) {\n      alert(\"This event is full.\");\n      return;\n    }\n\n    // 2. Food availability\n    const foodObj = event.food_items.find((f) => f.name === selectedFood);\n    if (!foodObj) {\n      alert(\"Invalid food selection.\");\n      return;\n    }\n\n    if (quantity > foodObj.quantity) {\n      alert(\"Not enough quantity available.\");\n      return;\n    }\n\n    // 3. Max 3 per person\n    if (quantity > 3) {\n      alert(\"You can only reserve up to 3 items.\");\n      return;\n    }\n\n    // 4. Prevent duplicate RSVPs by email\n    const { data: existingRSVP } = await supabase\n      .from(\"rsvps\")\n      .select(\"*\")\n      .eq(\"email\", email)\n      .eq(\"event_id\", eventId);\n\n    if (existingRSVP && existingRSVP.length > 0) {\n      alert(\"You already reserved food for this event.\");\n      return;\n    }\n\n    // Insert new RSVP\n    const { error } = await supabase.from(\"rsvps\").insert({\n      event_id: event.id,\n      name,\n      email,\n      food_item: selectedFood,\n      quantity,\n    });\n\n    if (error) {\n      console.error(\"SUPABASE RSVP ERROR →\", JSON.stringify(error, null, 2));\n      alert(\"Failed to reserve.\");\n      return;\n    }\n\n    // Update event attendees count AND food quantity\n    const updatedFood = event.food_items.map((item) =>\n      item.name === selectedFood\n        ? { ...item, quantity: item.quantity - quantity }\n        : item\n    );\n\n    await supabase\n      .from(\"events\")\n      .update({\n        attendees: event.attendees + 1,\n        food_items: updatedFood,\n      })\n      .eq(\"id\", event.id);\n\n    alert(\"Reservation confirmed!\");\n    router.refresh();\n  }\n\n  if (loading || !event)\n    return <div className=\"p-10 text-center\">Loading event...</div>;\n\n  return (\n<div className=\"min-h-screen flex flex-col bg-gradient-to-b from-white via-teal-50 to-teal-100\">\n      <main className=\"flex justify-center py-16 px-4\">\n        <div className=\"flex flex-col md:flex-row gap-10 w-full max-w-6xl\">\n          {/* Event Info */}\n          <div className=\"md:w-2/3 w-full bg-white p-8 rounded-2xl shadow-sm\">\n            <h2 className=\"text-3xl font-semibold mb-3\">{event.title}</h2>\n\n            <p className=\"text-gray-700 mb-6 leading-relaxed\">\n              {event.description}\n            </p>\n\n            <div className=\"space-y-3 mb-8 text-gray-600 text-sm\">\n              <p>\n                <strong>Location:</strong> {event.location}\n              </p>\n              <p>\n                <strong>Date:</strong> {event.event_date}\n              </p>\n              <p>\n                <strong>Time:</strong> {event.event_time}\n              </p>\n              <p>\n                <strong>Available Food:</strong>\n              </p>\n              <ul className=\"ml-6 list-disc\">\n                {event.food_items.map((item, i) => (\n                  <li key={i}>\n                    {item.name} — {item.quantity} available\n                  </li>\n                ))}\n              </ul>\n              <p>\n                <strong>Capacity:</strong> {event.attendees}/{event.capacity}\n              </p>\n            </div>\n\n            <div className=\"w-full bg-gray-200 h-64 flex items-center justify-center text-gray-600 rounded-lg border border-gray-300\">\n              Map or Event Image Here\n            </div>\n          </div>\n\n          {/* Reservation Form */}\n          <div className=\"md:w-1/3 w-full\">\n            <div className=\"bg-teal-600 text-white p-8 rounded-2xl shadow-md h-full flex flex-col justify-center\">\n              <h3 className=\"text-xl font-semibold mb-6 text-center\">\n                Reserve Food\n              </h3>\n\n              <form className=\"flex flex-col gap-4\" onSubmit={handleReserve}>\n                <div>\n                  <label className=\"block text-sm mb-1\">Full Name</label>\n                  <input\n                    type=\"text\"\n                    required\n                    value={name}\n                    onChange={(e) => setName(e.target.value)}\n                    className=\"p-2 w-full rounded-md text-black\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm mb-1\">BU Email</label>\n                  <input\n                    type=\"email\"\n                    required\n                    value={email}\n                    onChange={(e) => setEmail(e.target.value)}\n                    className=\"p-2 w-full rounded-md text-black\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm mb-1\">Select Food</label>\n                  <select\n                    required\n                    value={selectedFood}\n                    onChange={(e) => setSelectedFood(e.target.value)}\n                    className=\"p-2 w-full rounded-md text-black\"\n                  >\n                    <option value=\"\">Select an item</option>\n                    {event.food_items.map((item, i) =>\n                      item.quantity > 0 ? (\n                        <option key={i} value={item.name}>\n                          {item.name} ({item.quantity} left)\n                        </option>\n                      ) : null\n                    )}\n                  </select>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm mb-1\">Quantity</label>\n                  <input\n                    type=\"number\"\n                    min=\"1\"\n                    max=\"3\"\n                    required\n                    value={quantity}\n                    onChange={(e) => setQuantity(Number(e.target.value))}\n                    className=\"p-2 w-full rounded-md text-black\"\n                  />\n                  <p className=\"text-xs mt-1 opacity-80\">Max 3 per person</p>\n                </div>\n\n                <button\n                  type=\"submit\"\n                  className=\"bg-white text-teal-700 font-semibold py-2 rounded-md hover:bg-gray-100 mt-4\"\n                >\n                  Reserve\n                </button>\n              </form>\n            </div>\n          </div>\n        </div>\n      </main>\n\n      {/* Footer */}\n      <footer className=\"bg-black text-white text-center text-sm py-6 px-4 mt-12\">\n        <p>Boston University Center of Computing & Data Sciences: Duan Family Spark! Initiative</p>\n        <p>665 Commonwealth Ave., Boston, MA 02215 | Floor 2, Spark! Space</p>\n        <p>buspark@bu.edu</p>\n      </footer>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}