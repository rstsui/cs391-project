{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ajoha/Downloads/cs391-project/cs391-project/spark-bytes/frontend/src/app/profile_reserve/page.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/spark-bytes/frontend/src/app/profile_reserve/page.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/spark-bytes/frontend/src/app/profile_reserve/page.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,sSAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAyT,GACtV,uFACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 32, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ajoha/Downloads/cs391-project/cs391-project/spark-bytes/frontend/src/app/profile_reserve/page.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/spark-bytes/frontend/src/app/profile_reserve/page.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/spark-bytes/frontend/src/app/profile_reserve/page.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,sSAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAqS,GAClU,mEACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["C:/Users/ajoha/Downloads/cs391-project/cs391-project/spark-bytes/frontend/src/app/profile_reserve/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { supabase } from \"@/lib/supabaseClient\";\r\nimport { useAuthGuard } from \"@/lib/useAuthGuard\";\r\n\r\nfunction formatTime(timeString: string) {\r\n  if (!timeString) return \"\";\r\n\r\n  const [hourStr, minuteStr] = timeString.split(\":\");\r\n  let hour = parseInt(hourStr);\r\n  const minute = parseInt(minuteStr);\r\n\r\n  const ampm = hour >= 12 ? \"PM\" : \"AM\";\r\n\r\n  hour = hour % 12;\r\n  if (hour === 0) hour = 12;\r\n\r\n  return `${hour}:${minute.toString().padStart(2, \"0\")} ${ampm}`;\r\n}\r\n\r\ntype FoodItem = {\r\n  name: string;\r\n  quantity: number;\r\n};\r\n\r\nexport default function ProfileReserve() {\r\n  const router = useRouter();\r\n  const { loading: authLoading, user } = useAuthGuard(); // redirect to /login if not auth\r\n\r\n  const [rsvps, setRsvps] = useState<any[]>([]);\r\n  const [events, setEvents] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const [editingRsvp, setEditingRsvp] = useState<any>(null);\r\n  const [editFood, setEditFood] = useState(\"\");\r\n  const [editQuantity, setEditQuantity] = useState(1);\r\n\r\n  useEffect(() => {\r\n    const loadData = async () => {\r\n      if (!user) return;\r\n\r\n      if (!user.email?.endsWith(\"@bu.edu\")) {\r\n        await supabase.auth.signOut();\r\n        alert(\"You must use your BU email to log in.\");\r\n        router.push(\"/login\");\r\n        return;\r\n      }\r\n\r\n      const { data: rsvpData, error: rsvpError } = await supabase\r\n        .from(\"rsvps\")\r\n        .select(\"*, rsvp_items(*)\")\r\n        .eq(\"email\", user.email);\r\n\r\n      if (rsvpError) {\r\n        console.error(\"RSVP fetch error:\", rsvpError);\r\n      }\r\n\r\n      const { data: eventData, error: eventError } = await supabase\r\n        .from(\"events\")\r\n        .select(\"*\");\r\n\r\n      if (eventError) {\r\n        console.error(\"Event fetch error:\", eventError);\r\n      }\r\n\r\n      setRsvps(rsvpData || []);\r\n      setEvents(eventData || []);\r\n      setLoading(false);\r\n    };\r\n\r\n    if (!authLoading && user) {\r\n      loadData();\r\n    }\r\n  }, [authLoading, user, router]);\r\n\r\n  const handleCancel = async (rsvp: any) => {\r\n    const yes = confirm(\"Cancel this reservation?\");\r\n    if (!yes) return;\r\n\r\n    const { data: items, error: itemsError } = await supabase\r\n      .from(\"rsvp_items\")\r\n      .select(\"*\")\r\n      .eq(\"rsvp_id\", rsvp.id);\r\n\r\n    if (itemsError) {\r\n      console.error(itemsError);\r\n      alert(\"Could not load reservation items.\");\r\n      return;\r\n    }\r\n\r\n    const event = events.find((e) => e.id === rsvp.event_id);\r\n    if (!event) {\r\n      alert(\"Event not found.\");\r\n      return;\r\n    }\r\n\r\n    let updatedFood = [...event.food_items];\r\n\r\n    items.forEach((item: any) => {\r\n      updatedFood = updatedFood.map((food: any) =>\r\n        food.name === item.food_item\r\n          ? { ...food, quantity: food.quantity + item.quantity }\r\n          : food\r\n      );\r\n    });\r\n\r\n    const { error: updateError } = await supabase\r\n      .from(\"events\")\r\n      .update({\r\n        food_items: updatedFood,\r\n        attendees: Math.max(0, (event.attendees || 1) - 1),\r\n      })\r\n      .eq(\"id\", event.id);\r\n\r\n    if (updateError) {\r\n      console.error(updateError);\r\n      alert(\"Failed to update event inventory.\");\r\n      return;\r\n    }\r\n\r\n    await supabase.from(\"rsvp_items\").delete().eq(\"rsvp_id\", rsvp.id);\r\n\r\n    const { error: deleteError } = await supabase\r\n      .from(\"rsvps\")\r\n      .delete()\r\n      .eq(\"id\", rsvp.id);\r\n\r\n    if (deleteError) {\r\n      console.error(deleteError);\r\n      alert(\"Failed to delete RSVP.\");\r\n      return;\r\n    }\r\n\r\n    alert(\"Reservation canceled.\");\r\n\r\n    setEvents((prev) =>\r\n      prev.map((e) =>\r\n        e.id === event.id\r\n          ? {\r\n              ...e,\r\n              food_items: updatedFood,\r\n              attendees: event.attendees - 1,\r\n            }\r\n          : e\r\n      )\r\n    );\r\n\r\n    setRsvps((prev) => prev.filter((x) => x.id !== rsvp.id));\r\n  };\r\n\r\n  const handleEditSubmit = async () => {\r\n    if (!editingRsvp) return;\r\n\r\n    const rsvpId = editingRsvp.id;\r\n    const event = events.find((e) => e.id === editingRsvp.event_id);\r\n    if (!event) return;\r\n\r\n    const { data: existingItems, error: loadErr } = await supabase\r\n      .from(\"rsvp_items\")\r\n      .select(\"*\")\r\n      .eq(\"rsvp_id\", rsvpId);\r\n\r\n    if (loadErr) {\r\n      console.error(loadErr);\r\n      alert(\"Failed to load existing items.\");\r\n      return;\r\n    }\r\n\r\n    const oldItem = existingItems.find(\r\n      (i: { food_item: string }) => i.food_item === editFood\r\n    );\r\n    const oldQty = oldItem?.quantity || 0;\r\n    const newQty = editQuantity;\r\n\r\n    if (newQty > 3) {\r\n      alert(\"You may only reserve up to 3 of each item.\");\r\n      return;\r\n    }\r\n\r\n    const updatedFood = event.food_items.map(\r\n      (item: { name: string; quantity: number }) => {\r\n        if (item.name === editFood) {\r\n          return {\r\n            ...item,\r\n            quantity: item.quantity + oldQty - newQty,\r\n          };\r\n        }\r\n        return item;\r\n      }\r\n    );\r\n\r\n    if (updatedFood.some((i: { quantity: number }) => i.quantity < 0)) {\r\n      alert(\"Not enough quantity available.\");\r\n      return;\r\n    }\r\n\r\n    if (newQty === 0 && oldItem) {\r\n      await supabase.from(\"rsvp_items\").delete().eq(\"id\", oldItem.id);\r\n\r\n      await supabase\r\n        .from(\"events\")\r\n        .update({ food_items: updatedFood })\r\n        .eq(\"id\", event.id);\r\n\r\n      alert(\"Item removed!\");\r\n\r\n      setEvents((prev) =>\r\n        prev.map((ev) =>\r\n          ev.id === event.id ? { ...ev, food_items: updatedFood } : ev\r\n        )\r\n      );\r\n\r\n      setRsvps((prev) =>\r\n        prev.map((r) =>\r\n          r.id === rsvpId\r\n            ? {\r\n                ...r,\r\n                rsvp_items: existingItems.filter(\r\n                  (it: any) => it.food_item !== editFood\r\n                ),\r\n              }\r\n            : r\r\n        )\r\n      );\r\n\r\n      setEditingRsvp(null);\r\n      return;\r\n    }\r\n\r\n    if (oldItem) {\r\n      await supabase\r\n        .from(\"rsvp_items\")\r\n        .update({ quantity: newQty })\r\n        .eq(\"id\", oldItem.id);\r\n    } else {\r\n      await supabase.from(\"rsvp_items\").insert({\r\n        rsvp_id: rsvpId,\r\n        food_item: editFood,\r\n        quantity: newQty,\r\n      });\r\n    }\r\n\r\n    await supabase\r\n      .from(\"events\")\r\n      .update({ food_items: updatedFood })\r\n      .eq(\"id\", event.id);\r\n\r\n    alert(\"Reservation item updated!\");\r\n\r\n    const updatedItems = oldItem\r\n      ? existingItems.map((it: any) =>\r\n          it.food_item === editFood ? { ...it, quantity: newQty } : it\r\n        )\r\n      : [...existingItems, { food_item: editFood, quantity: newQty }];\r\n\r\n    setEvents((prev) =>\r\n      prev.map((ev) =>\r\n        ev.id === event.id ? { ...ev, food_items: updatedFood } : ev\r\n      )\r\n    );\r\n\r\n    setRsvps((prev) =>\r\n      prev.map((r) =>\r\n        r.id === rsvpId ? { ...r, rsvp_items: updatedItems } : r\r\n      )\r\n    );\r\n\r\n    setEditingRsvp(null);\r\n  };\r\n\r\n  if (authLoading || loading) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center text-lg\">\r\n        Loading reservations…\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!user) return null;\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex flex-col bg-gradient-to-b from-white via-teal-50 to-teal-100\">\r\n      <main className=\"flex-1 px-10 py-16 max-w-6xl mx-auto w-full\">\r\n        <h1 className=\"text-3xl font-semibold text-center mb-2\">\r\n          My Reservations\r\n        </h1>\r\n        <p className=\"text-lg text-center mb-12\">\r\n          Food pickups you have reserved\r\n        </p>\r\n\r\n        <section className=\"flex flex-wrap justify-center gap-6 px-8 pb-12 mt-10\">\r\n          {rsvps.length === 0 && (\r\n            <p className=\"text-gray-700 text-center\">\r\n              You have no reservations yet.\r\n            </p>\r\n          )}\r\n\r\n          {rsvps.map((rsvp) => {\r\n            const event = events.find((e) => e.id === rsvp.event_id);\r\n\r\n            return (\r\n              <div\r\n                key={rsvp.id}\r\n                className=\"bg-white border border-black w-72 p-6 rounded-2xl shadow-sm\"\r\n              >\r\n                <h2 className=\"text-xl font-semibold\">{event?.title}</h2>\r\n\r\n                <p className=\"mt-3 text-gray-700\">\r\n                  <strong>Date:</strong> {event?.event_date}\r\n                </p>\r\n\r\n                <p className=\"text-gray-700\">\r\n                  <strong>Time:</strong> {formatTime(event?.event_time)}\r\n                </p>\r\n\r\n                <p className=\"text-gray-700\">\r\n                  <strong>Location:</strong> {event?.location}\r\n                </p>\r\n\r\n                <p className=\"text-gray-700 mt-3\">\r\n                  <strong>Items:</strong>\r\n                </p>\r\n                {rsvp.rsvp_items && rsvp.rsvp_items.length > 0 ? (\r\n                  <ul className=\"list-disc ml-5 text-gray-700\">\r\n                    {rsvp.rsvp_items.map((item: any) => (\r\n                      <li key={item.id}>\r\n                        {item.food_item} &times; {item.quantity}\r\n                      </li>\r\n                    ))}\r\n                  </ul>\r\n                ) : (\r\n                  <p className=\"text-gray-700\">No items reserved.</p>\r\n                )}\r\n\r\n                <div className=\"flex gap-3 mt-6\">\r\n                  <button\r\n                    onClick={() => handleCancel(rsvp)}\r\n                    className=\"bg-red-500 text-white px-4 py-1 rounded-md hover:bg-red-600\"\r\n                  >\r\n                    Cancel\r\n                  </button>\r\n\r\n                  <button\r\n                    onClick={() => {\r\n                      setEditingRsvp(rsvp);\r\n                      const firstItem = rsvp.rsvp_items?.[0];\r\n                      setEditFood(firstItem?.food_item || \"\");\r\n                      setEditQuantity(firstItem?.quantity || 1);\r\n                    }}\r\n                    className=\"bg-gray-200 text-gray-800 px-4 py-1 rounded-md hover:bg-gray-300\"\r\n                  >\r\n                    Edit\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            );\r\n          })}\r\n        </section>\r\n      </main>\r\n\r\n      {editingRsvp && (\r\n        <div className=\"fixed inset-0 bg-black/20 backdrop-blur-sm flex items-center justify-center z-50\">\r\n          <div className=\"bg-white p-6 rounded-xl w-96 shadow-xl\">\r\n            <h2 className=\"text-xl font-semibold mb-4\">\r\n              Edit Reservation —{\" \"}\r\n              {events.find((e) => e.id === editingRsvp.event_id)?.title}\r\n            </h2>\r\n\r\n            <label className=\"block font-medium mb-1\">Food Item</label>\r\n            <select\r\n              value={editFood || \"\"}\r\n              onChange={(e) => setEditFood(e.target.value)}\r\n              className=\"border w-full px-3 py-2 rounded mb-4\"\r\n            >\r\n              {events\r\n                .find((e) => e.id === editingRsvp.event_id)\r\n                ?.food_items.map((item: any) => (\r\n                  <option key={item.name} value={item.name}>\r\n                    {item.name} ({item.quantity} left)\r\n                  </option>\r\n                ))}\r\n            </select>\r\n\r\n            <label className=\"block font-medium mb-1\">\r\n              Quantity (max 3)\r\n            </label>\r\n            <input\r\n              type=\"number\"\r\n              min={1}\r\n              max={3}\r\n              value={editQuantity}\r\n              onChange={(e) => setEditQuantity(Number(e.target.value))}\r\n              className=\"border w-full px-3 py-2 rounded mb-6\"\r\n            />\r\n\r\n            <div className=\"flex justify-between\">\r\n              <button\r\n                onClick={() => setEditingRsvp(null)}\r\n                className=\"px-4 py-2 bg-gray-300 rounded hover:bg-gray-400\"\r\n              >\r\n                Close\r\n              </button>\r\n\r\n              <button\r\n                onClick={handleEditSubmit}\r\n                className=\"px-4 py-2 bg-teal-600 text-white rounded hover:bg-teal-700\"\r\n              >\r\n                Save Changes\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <footer className=\"bg-black text-white text-center text-sm py-6 px-4 mt-auto\">\r\n        <p>\r\n          Boston University Center of Computing & Data Sciences: Duan Family\r\n          Spark! Initiative\r\n        </p>\r\n        <p>665 Commonwealth Ave., Boston, MA 02215 | Floor 2, Spark! Space</p>\r\n        <p>buspark@bu.edu</p>\r\n      </footer>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["useEffect","useState","useRouter","supabase","useAuthGuard","jsx","_jsx","jsxs","_jsxs","formatTime","timeString","hourStr","minuteStr","split","hour","parseInt","minute","ampm","toString","padStart","ProfileReserve","router","loading","authLoading","user","rsvps","setRsvps","events","setEvents","setLoading","editingRsvp","setEditingRsvp","editFood","setEditFood","editQuantity","setEditQuantity","loadData","email","endsWith","auth","signOut","alert","push","data","rsvpData","error","rsvpError","from","select","eq","console","eventData","eventError","handleCancel","rsvp","yes","confirm","items","itemsError","id","event","find","e","event_id","updatedFood","food_items","forEach","item","map","food","name","food_item","quantity","updateError","update","attendees","Math","max","delete","deleteError","prev","filter","x","handleEditSubmit","rsvpId","existingItems","loadErr","oldItem","i","oldQty","newQty","some","ev","r","rsvp_items","it","insert","rsvp_id","updatedItems","className","children","length","title","event_date","event_time","location","onClick","firstItem","value","onChange","target","type","min","Number"],"mappings":"","ignoreList":[],"debugId":null}}]
}