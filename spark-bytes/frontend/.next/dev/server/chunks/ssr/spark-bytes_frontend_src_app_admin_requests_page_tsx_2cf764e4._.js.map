{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/reneetsui/Desktop/391%20project/cs391-project/spark-bytes/frontend/src/app/admin/requests/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { supabase } from \"@/lib/supabaseClient\";\nimport { useRouter } from \"next/navigation\";\n\ntype RequestRow = {\n  id: string;\n  user_id: string;\n  message: string;\n  status: string;\n  requested_at: string;\n  email: string;\n};\n\nexport default function AdminRequestsPage() {\n  const router = useRouter();\n\n  const [isAdmin, setIsAdmin] = useState<boolean | null>(null); // null = still checking\n  const [requests, setRequests] = useState<RequestRow[]>([]);\n  const [filter, setFilter] = useState<\"all\" | \"pending\" | \"approved\" | \"rejected\">(\"all\");\n\n  // Admin Gatekeeping\n  useEffect(() => {\n    async function checkAdmin() {\n      const { data: auth } = await supabase.auth.getUser();\n      const user = auth?.user;\n\n      if (!user) {\n        router.push(\"/login\");\n        return;\n      }\n\n      const { data: profile } = await supabase\n        .from(\"profiles\")\n        .select(\"role\")\n        .eq(\"id\", user.id)\n        \n        .maybeSingle();\n\n      if (!profile || profile.role !== \"admin\") {\n        router.push(\"/request_access\");\n        return;\n      }\n\n      setIsAdmin(true);\n    }\n\n    checkAdmin();\n  }, [router]);\n\n  // Load Requests\n  async function loadRequests() {\n    const { data, error } = await supabase\n      .from(\"admin_requests_with_profiles\")\n      .select(\"*\")\n      .order(\"requested_at\", { ascending: false });\n\n    if (error) {\n      console.error(\"Error loading requests:\", error);\n      return;\n    }\n\n    if (!data) return;\n\n    setRequests(\n      data.map((row: any) => ({\n        id: row.id,\n        user_id: row.user_id,\n        message: row.message,\n        status: row.status,\n        requested_at: row.requested_at,\n        email: row.email,\n      }))\n    );\n  }\n\n  useEffect(() => {\n    if (isAdmin) loadRequests();\n  }, [isAdmin]);\n\n  // Update Request Status\n  async function updateStatus(id: string, newStatus: \"approved\" | \"rejected\") {\n    // fetch user_id\n    const { data: reqRow } = await supabase\n      .from(\"admin_requests\")\n      .select(\"user_id\")\n      .eq(\"id\", id)\n      .maybeSingle();\n\n    if (!reqRow) return alert(\"Unable to load request.\");\n\n    const userId = reqRow.user_id;\n\n    // update request\n    const { error: statusErr } = await supabase\n      .from(\"admin_requests\")\n      .update({ status: newStatus })\n      .eq(\"id\", id);\n\n    if (statusErr) {\n      alert(statusErr.message);\n      return;\n    }\n\n    // promote to admin\n    if (newStatus === \"approved\") {\n      const { error: roleErr } = await supabase\n        .from(\"profiles\")\n        .update({ role: \"admin\" })\n        .eq(\"id\", userId);\n\n      if (roleErr) {\n        alert(roleErr.message);\n        return;\n      }\n    }\n\n    loadRequests();\n  }\n\n  // FILTER SYSTEM\n  const filteredRequests =\n    filter === \"all\" ? requests : requests.filter((req) => req.status === filter);\n\n  // Render Logic\n\n  // Still checking admin?\n  if (isAdmin === null) {\n    return (\n      <div className=\"p-10 text-center\">\n        Checking accessâ€¦\n      </div>\n    );\n  }\n\n  // Non-admin users will already be redirected.\n  if (!isAdmin) return null;\n\n  return (\n    <div className=\"p-10 max-w-3xl mx-auto\">\n      <h1 className=\"text-3xl font-bold mb-6\">Admin Access Requests</h1>\n\n      {/* FILTER BUTTONS */}\n      <div className=\"flex gap-4 mb-6\">\n        {[\"all\", \"pending\", \"approved\", \"rejected\"].map((f) => (\n          <button\n            key={f}\n            onClick={() => setFilter(f as any)}\n            className={`px-4 py-2 rounded-lg border ${\n              filter === f\n                ? \"bg-teal-600 text-white border-teal-600\"\n                : \"bg-white text-gray-700 border-gray-300\"\n            }`}\n          >\n            {f[0].toUpperCase() + f.slice(1)}\n          </button>\n        ))}\n      </div>\n\n      {filteredRequests.length === 0 && (\n        <p className=\"text-gray-600\">No requests found.</p>\n      )}\n\n      {filteredRequests.map((req) => (\n        <div key={req.id} className=\"border p-5 rounded-xl shadow-sm bg-white mb-4\">\n          <div className=\"flex justify-between mb-2\">\n            <p className=\"font-semibold text-lg\">{req.email}</p>\n            <span\n              className={`px-3 py-1 text-sm rounded-full ${\n                req.status === \"pending\"\n                  ? \"bg-yellow-100 text-yellow-800\"\n                  : req.status === \"approved\"\n                  ? \"bg-green-100 text-green-800\"\n                  : \"bg-red-100 text-red-800\"\n              }`}\n            >\n              {req.status[0].toUpperCase() + req.status.slice(1)}\n            </span>\n          </div>\n\n          <p className=\"text-gray-700 mb-3\">{req.message}</p>\n\n          <p className=\"text-sm text-gray-500 mb-4\">\n            Requested on: {new Date(req.requested_at).toLocaleString()}\n          </p>\n\n          {req.status === \"pending\" && (\n            <div className=\"flex gap-3\">\n              <button\n                onClick={() => updateStatus(req.id, \"approved\")}\n                className=\"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700\"\n              >\n                Approve\n              </button>\n\n              <button\n                onClick={() => updateStatus(req.id, \"rejected\")}\n                className=\"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700\"\n              >\n                Reject\n              </button>\n            </div>\n          )}\n        </div>\n      ))}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}