{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ajoha/Downloads/cs391-project/cs391-project/spark-bytes/frontend/src/app/admin/requests/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { supabase } from \"@/lib/supabaseClient\";\r\nimport { useRouter } from \"next/navigation\";\r\n\r\ntype RequestRow = {\r\n  id: string;\r\n  user_id: string;\r\n  message: string;\r\n  status: string;\r\n  requested_at: string;\r\n  email: string;\r\n};\r\n\r\nexport default function AdminRequestsPage() {\r\n  const router = useRouter();\r\n\r\n  const [isAdmin, setIsAdmin] = useState<boolean | null>(null); // null = still checking\r\n  const [requests, setRequests] = useState<RequestRow[]>([]);\r\n  const [filter, setFilter] = useState<\"all\" | \"pending\" | \"approved\" | \"rejected\">(\"all\");\r\n\r\n  // Admin Gatekeeping\r\n  useEffect(() => {\r\n    async function checkAdmin() {\r\n      const { data: auth } = await supabase.auth.getUser();\r\n      const user = auth?.user;\r\n\r\n      if (!user) {\r\n        router.push(\"/login\");\r\n        return;\r\n      }\r\n\r\n      const { data: profile } = await supabase\r\n        .from(\"profiles\")\r\n        .select(\"role\")\r\n        .eq(\"id\", user.id)\r\n        \r\n        .maybeSingle();\r\n\r\n      if (!profile || profile.role !== \"admin\") {\r\n        router.push(\"/request_access\");\r\n        return;\r\n      }\r\n\r\n      setIsAdmin(true);\r\n    }\r\n\r\n    checkAdmin();\r\n  }, [router]);\r\n\r\n  // Load Requests\r\n  async function loadRequests() {\r\n    const { data, error } = await supabase\r\n      .from(\"admin_requests_with_profiles\")\r\n      .select(\"*\")\r\n      .order(\"requested_at\", { ascending: false });\r\n\r\n    if (error) {\r\n      console.error(\"Error loading requests:\", error);\r\n      return;\r\n    }\r\n\r\n    if (!data) return;\r\n\r\n    setRequests(\r\n      data.map((row: any) => ({\r\n        id: row.id,\r\n        user_id: row.user_id,\r\n        message: row.message,\r\n        status: row.status,\r\n        requested_at: row.requested_at,\r\n        email: row.email,\r\n      }))\r\n    );\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (isAdmin) loadRequests();\r\n  }, [isAdmin]);\r\n\r\n  // Update Request Status\r\n  async function updateStatus(id: string, newStatus: \"approved\" | \"rejected\") {\r\n    // fetch user_id\r\n    const { data: reqRow } = await supabase\r\n      .from(\"admin_requests\")\r\n      .select(\"user_id\")\r\n      .eq(\"id\", id)\r\n      .maybeSingle();\r\n\r\n    if (!reqRow) return alert(\"Unable to load request.\");\r\n\r\n    const userId = reqRow.user_id;\r\n\r\n    // update request\r\n    const { error: statusErr } = await supabase\r\n      .from(\"admin_requests\")\r\n      .update({ status: newStatus })\r\n      .eq(\"id\", id);\r\n\r\n    if (statusErr) {\r\n      alert(statusErr.message);\r\n      return;\r\n    }\r\n\r\n    // promote to admin\r\n    if (newStatus === \"approved\") {\r\n      const { error: roleErr } = await supabase\r\n        .from(\"profiles\")\r\n        .update({ role: \"admin\" })\r\n        .eq(\"id\", userId);\r\n\r\n      if (roleErr) {\r\n        alert(roleErr.message);\r\n        return;\r\n      }\r\n    }\r\n\r\n    loadRequests();\r\n  }\r\n\r\n  // FILTER SYSTEM\r\n  const filteredRequests =\r\n    filter === \"all\" ? requests : requests.filter((req) => req.status === filter);\r\n\r\n  // Render Logic\r\n\r\n  // Still checking admin?\r\n  if (isAdmin === null) {\r\n    return (\r\n      <div className=\"p-10 text-center\">\r\n        Checking accessâ€¦\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Non-admin users will already be redirected.\r\n  if (!isAdmin) return null;\r\n\r\n  return (\r\n    <div className=\"p-10 max-w-3xl mx-auto\">\r\n      <h1 className=\"text-3xl font-bold mb-6\">Admin Access Requests</h1>\r\n\r\n      {/* FILTER BUTTONS */}\r\n      <div className=\"flex gap-4 mb-6\">\r\n        {[\"all\", \"pending\", \"approved\", \"rejected\"].map((f) => (\r\n          <button\r\n            key={f}\r\n            onClick={() => setFilter(f as any)}\r\n            className={`px-4 py-2 rounded-lg border ${\r\n              filter === f\r\n                ? \"bg-teal-600 text-white border-teal-600\"\r\n                : \"bg-white text-gray-700 border-gray-300\"\r\n            }`}\r\n          >\r\n            {f[0].toUpperCase() + f.slice(1)}\r\n          </button>\r\n        ))}\r\n      </div>\r\n\r\n      {filteredRequests.length === 0 && (\r\n        <p className=\"text-gray-600\">No requests found.</p>\r\n      )}\r\n\r\n      {filteredRequests.map((req) => (\r\n        <div key={req.id} className=\"border p-5 rounded-xl shadow-sm bg-white mb-4\">\r\n          <div className=\"flex justify-between mb-2\">\r\n            <p className=\"font-semibold text-lg\">{req.email}</p>\r\n            <span\r\n              className={`px-3 py-1 text-sm rounded-full ${\r\n                req.status === \"pending\"\r\n                  ? \"bg-yellow-100 text-yellow-800\"\r\n                  : req.status === \"approved\"\r\n                  ? \"bg-green-100 text-green-800\"\r\n                  : \"bg-red-100 text-red-800\"\r\n              }`}\r\n            >\r\n              {req.status[0].toUpperCase() + req.status.slice(1)}\r\n            </span>\r\n          </div>\r\n\r\n          <p className=\"text-gray-700 mb-3\">{req.message}</p>\r\n\r\n          <p className=\"text-sm text-gray-500 mb-4\">\r\n            Requested on: {new Date(req.requested_at).toLocaleString()}\r\n          </p>\r\n\r\n          {req.status === \"pending\" && (\r\n            <div className=\"flex gap-3\">\r\n              <button\r\n                onClick={() => updateStatus(req.id, \"approved\")}\r\n                className=\"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700\"\r\n              >\r\n                Approve\r\n              </button>\r\n\r\n              <button\r\n                onClick={() => updateStatus(req.id, \"rejected\")}\r\n                className=\"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700\"\r\n              >\r\n                Reject\r\n              </button>\r\n            </div>\r\n          )}\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}