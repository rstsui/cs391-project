{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/karachionwuanibe/Desktop/cs~391/projects/cs391-project2/cs391-project/spark-bytes/frontend/src/app/profile_reserve/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { supabase } from \"@/lib/supabaseClient\";\n\n/* Format time like 7:30 PM */\nfunction formatTime(timeString: string) {\n  if (!timeString) return \"\";\n\n  const [hourStr, minuteStr] = timeString.split(\":\");\n  let hour = parseInt(hourStr);\n  const minute = parseInt(minuteStr);\n\n  const ampm = hour >= 12 ? \"PM\" : \"AM\";\n\n  hour = hour % 12;\n  if (hour === 0) hour = 12;\n\n  return `${hour}:${minute.toString().padStart(2, \"0\")} ${ampm}`;\n}\n\nexport default function ProfileReserve() {\n  const router = useRouter();\n\n  const [rsvps, setRsvps] = useState<any[]>([]);\n  const [events, setEvents] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  const [editingRsvp, setEditingRsvp] = useState<any>(null);\n  const [editFood, setEditFood] = useState(\"\");\n  const [editQuantity, setEditQuantity] = useState(1);\n\n  /* Load RSVPs + Events */\n  useEffect(() => {\n    const loadData = async () => {\n      const { data } = await supabase.auth.getUser();\n      const user = data?.user;\n\n      if (!user) {\n        router.push(\"/login\");\n        return;\n      }\n\n      if (!user.email?.endsWith(\"@bu.edu\")) {\n        await supabase.auth.signOut();\n        alert(\"You must use your BU email to log in.\");\n        router.push(\"/login\");\n        return;\n      }\n\n      // Load RSVPs\n      const { data: rsvpData, error: rsvpError } = await supabase\n        .from(\"rsvps\")\n        .select(\"*\")\n        .eq(\"email\", user.email);\n\n      if (rsvpError) console.error(\"RSVP fetch error:\", rsvpError);\n\n      // Load events\n      const { data: eventData, error: eventError } = await supabase\n        .from(\"events\")\n        .select(\"*\");\n\n      if (eventError) console.error(\"Event fetch error:\", eventError);\n\n      setRsvps(rsvpData || []);\n      setEvents(eventData || []);\n      setLoading(false);\n    };\n\n    loadData();\n  }, [router]);\n\n  /* CANCEL A RESERVATION */\n  const handleCancel = async (rsvp: any) => {\n    const confirmDelete = confirm(\n      `Cancel reservation for ${rsvp.food_item} (x${rsvp.quantity})?`\n    );\n    if (!confirmDelete) return;\n\n    const event = events.find((e) => e.id === rsvp.event_id);\n    if (!event) return;\n\n    // Restore quantity\n    const updatedFoodItems = event.food_items.map((item: any) =>\n      item.name === rsvp.food_item\n        ? { ...item, quantity: item.quantity + rsvp.quantity }\n        : item\n    );\n\n    // Update event inventory\n    const { error: updateError } = await supabase\n      .from(\"events\")\n      .update({ food_items: updatedFoodItems })\n      .eq(\"id\", event.id);\n\n    if (updateError) {\n      alert(\"Failed to restore food quantity.\");\n      console.error(updateError);\n      return;\n    }\n\n    // Delete RSVP\n    const { error: deleteError } = await supabase\n      .from(\"rsvps\")\n      .delete()\n      .eq(\"id\", rsvp.id);\n\n    if (deleteError) {\n      alert(\"Failed to cancel reservation.\");\n      console.error(deleteError);\n      return;\n    }\n\n    alert(\"Reservation canceled.\");\n\n    // Update UI\n    setRsvps((prev) => prev.filter((item) => item.id !== rsvp.id));\n  };\n\n  /* SAVE EDIT */\n  const handleEditSubmit = async () => {\n    if (!editingRsvp) return;\n\n    const event = events.find((e) => e.id === editingRsvp.event_id);\n    if (!event) return;\n\n    const oldFood = editingRsvp.food_item;\n    const oldQty = editingRsvp.quantity;\n\n    // Add old qty back first\n    let updated = event.food_items.map((item: any) =>\n      item.name === oldFood\n        ? { ...item, quantity: item.quantity + oldQty }\n        : item\n    );\n\n    // Subtract new qty\n    updated = updated.map((item: any) =>\n      item.name === editFood\n        ? { ...item, quantity: item.quantity - editQuantity }\n        : item\n    );\n\n    // Check inventory\n    if (updated.some((item: any) => item.quantity < 0)) {\n      alert(\"Not enough quantity available.\");\n      return;\n    }\n\n    // Update RSVP\n    const { error: rsvpUpdateError } = await supabase\n      .from(\"rsvps\")\n      .update({\n        food_item: editFood,\n        quantity: editQuantity,\n      })\n      .eq(\"id\", editingRsvp.id);\n\n    if (rsvpUpdateError) {\n      alert(\"Failed to update RSVP.\");\n      return;\n    }\n\n    // Update event food list\n    const { error: eventError } = await supabase\n      .from(\"events\")\n      .update({ food_items: updated })\n      .eq(\"id\", event.id);\n\n    if (eventError) {\n      alert(\"Failed to update event food inventory.\");\n      return;\n    }\n\n    alert(\"Reservation updated!\");\n\n    // Update UI\n    setEditingRsvp(null);\n\n    setRsvps((prev) =>\n      prev.map((item) =>\n        item.id === editingRsvp.id\n          ? { ...item, food_item: editFood, quantity: editQuantity }\n          : item\n      )\n    );\n  };\n\n  /* LOADING SCREEN */\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex justify-center items-center text-lg\">\n        Loading reservations...\n      </div>\n    );\n  }\n\n  /* UI */\n  return (\n    <div className=\"min-h-screen flex flex-col bg-gradient-to-b from-white via-teal-50 to-teal-100\">\n      <main className=\"flex-1 px-10 py-16 max-w-6xl mx-auto w-full\">\n        <h1 className=\"text-3xl font-semibold text-center mb-2\">My Events</h1>\n        <p className=\"text-lg text-center mb-12\">Food pickups you have reserved</p>\n\n        <section className=\"flex flex-wrap justify-center gap-6 px-8 pb-12 mt-10\">\n          {rsvps.length === 0 && (\n            <p className=\"text-gray-700 text-center\">You have no reservations yet.</p>\n          )}\n\n          {rsvps.map((rsvp) => {\n            const event = events.find((e) => e.id === rsvp.event_id);\n\n            return (\n              <div\n                key={rsvp.id}\n                className=\"bg-white border border-black w-72 p-6 rounded-2xl shadow-sm\"\n              >\n                <h2 className=\"text-xl font-semibold\">{event?.title}</h2>\n\n                <p className=\"mt-3 text-gray-700\">\n                  <strong>Date:</strong> {event?.event_date}\n                </p>\n\n                <p className=\"text-gray-700\">\n                  <strong>Time:</strong> {formatTime(event?.event_time)}\n                </p>\n\n                <p className=\"text-gray-700\">\n                  <strong>Location:</strong> {event?.location}\n                </p>\n\n                <p className=\"text-gray-700 mt-3\">\n                  <strong>Food Item:</strong> {rsvp.food_item}\n                </p>\n\n                <p className=\"text-gray-700\">\n                  <strong>Quantity:</strong> {rsvp.quantity}\n                </p>\n\n                <div className=\"flex gap-3 mt-6\">\n                  <button\n                    onClick={() => handleCancel(rsvp)}\n                    className=\"bg-red-500 text-white px-4 py-1 rounded-md hover:bg-red-600\"\n                  >\n                    Cancel\n                  </button>\n\n                  <button\n                    onClick={() => {\n                      setEditingRsvp(rsvp);\n                      setEditFood(rsvp.food_item);\n                      setEditQuantity(rsvp.quantity);\n                    }}\n                    className=\"bg-gray-200 text-gray-800 px-4 py-1 rounded-md hover:bg-gray-300\"\n                  >\n                    Edit\n                  </button>\n                </div>\n              </div>\n            );\n          })}\n        </section>\n      </main>\n\n      {/* EDIT POPUP */}\n      {editingRsvp && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50\">\n          <div className=\"bg-white p-6 rounded-xl w-96 shadow-xl\">\n            <h2 className=\"text-xl font-semibold mb-4\">\n              Edit Reservation â€” {events.find((e) => e.id === editingRsvp.event_id)?.title}\n            </h2>\n\n            <label className=\"block font-medium mb-1\">Food Item</label>\n            <select\n              value={editFood}\n              onChange={(e) => setEditFood(e.target.value)}\n              className=\"border w-full px-3 py-2 rounded mb-4\"\n            >\n              {events\n                .find((e) => e.id === editingRsvp.event_id)\n                ?.food_items.map((item: any) => (\n                  <option key={item.name} value={item.name}>\n                    {item.name} ({item.quantity} left)\n                  </option>\n                ))}\n            </select>\n\n            <label className=\"block font-medium mb-1\">Quantity (max 3)</label>\n            <input\n              type=\"number\"\n              min={1}\n              max={3}\n              value={editQuantity}\n              onChange={(e) => setEditQuantity(Number(e.target.value))}\n              className=\"border w-full px-3 py-2 rounded mb-6\"\n            />\n\n            <div className=\"flex justify-between\">\n              <button\n                onClick={() => setEditingRsvp(null)}\n                className=\"px-4 py-2 bg-gray-300 rounded hover:bg-gray-400\"\n              >\n                Close\n              </button>\n\n              <button\n                onClick={handleEditSubmit}\n                className=\"px-4 py-2 bg-teal-600 text-white rounded hover:bg-teal-700\"\n              >\n                Save Changes\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      <footer className=\"bg-black text-white text-center text-sm py-6 px-4 mt-auto\">\n        <p>Boston University Center of Computing & Data Sciences: Duan Family Spark! Initiative</p>\n        <p>665 Commonwealth Ave., Boston, MA 02215 | Floor 2, Spark! Space</p>\n        <p>buspark@bu.edu</p>\n      </footer>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}